{% extends 'kafedra/base.html' %} 


{% block content %}
<!-- modul porfolio img start -->
<div class="popup">
  <span class="exit">&times;</span>
  <center>
  <div class="popup-image position-relative">
      <div class="pdf_bar w-100 h-100  mt-5">
        <button class="btn btn-primary me-3" id="prev-page">
          <i class="fa-regular fa-circle-left"></i>
        </button>
        <span class="page_num">1</span> / <span class="page_count">3</span>
        <button class="btn btn-primary ms-3" id="next-page">
          <i class="fa-regular fa-circle-right"></i>
        </button>
        <div class="canvas position-relative">

        </div>
        <!-- <canvas data-pdf="" class="w-100 jsImg shadow pdf_render">
        </canvas> -->
      </div>
    </div>
  </center>
</div>
<!-- modul porfolio img end -->
<!-- portfolio start -->
<section class="portfolio_section">
  <div class="container_new mt-50">
    <p class="fs-13">Asosiy / <span class="text-muted">o'qituvchilar</span></p>
    <h4 class="text-uppercase">Portfolio</h4>
    <div class="shadow pt-5 pb-3 mt-5">
      <!-- ourself about start -->
      <div class="card border mx-sm-5 my-4">
        <div class="card-header">
          <h5 class="text-uppercase text-center text-lg-start fw-bold text-muted">
            {{ teacher.rank }}
          </h5>
        </div>
        <div class="row align-items-center p-4">
          <div class="col-12 col-lg-3 border_end">
            <center>
              <div class="img_div border mt-3">
                {% if teacher.avatar %}
                <img class="img_card mt-10" src="{{ teacher.avatar.url }}" alt="" />
                {% else %}
                <img class="img_card mt-10"
                  src="https://corporateofficeheadquarters.org/wp-content/uploads/2021/05/Sam-Richman-1536x1536.jpg"
                  alt="" />
                {% endif %}
              </div>
              <div class="icons mt-4">
                <div class="icons_div first_bg">
                  <a href="{{ teacher.telegram }}">
                    <i class="fa-sharp fa-solid fa-paper-plane"></i>
                  </a>
                </div>
                <div class="icons_div first_bg">
                  <a href="{{ teacher.facebook }}">
                    <i class="fa-brands fa-facebook-f"> </i>
                  </a>
                </div>
                <div class="icons_div first_bg">
                  <a href="{{ teacher.instagram }}">
                    <i class="fa-brands fa-instagram"></i>
                  </a>
                </div>
              </div>
            </center>
          </div>
          <div class="col-12 col-lg-9 ps-4 mt-4 mt-lg-0">
            <h2 class="text-center text-lg-start">
              {{ teacher.teacher_id.first_name }}
            </h2>
            <h6>
              <i class="fa-solid fa-phone text-success"></i>
              {{ teacher.phone_number }}
            </h6>
            <p>
              <i class="fa-solid fa-envelope text-warning"></i>
              {{ teacher.teacher_id.email }}
            </p>
          </div>
        </div>
      </div>
      <!-- ourself about end -->

      <!-- portfolio start -->
      <div class="border-top border-info border-2 mt-5 mx-3">
        <p class="mb-5 mt-3 text-start">Kasbiy faoliyat</p>
        <div id="portfolio" class="portfolio">
          <!-- left img -->
          {% for portfolio in portfolios %} {% if forloop.counter|divisibleby:2 %}
          <div class="card portfolio_card mb-3">
            <div class="row align-items-center g-0">
              <div class="col-md-4">
                <canvas data-pdf="{{ portfolio.portfolio_file.url }}" class="w-100 port_card_img jsImg shadow pdf_render">
                </canvas>
              </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title">
                    <b>Kategoriya:</b> {{ portfolio.category }}
                  </h5>
                  <h5 class="card-title">
                    <b>Nomi:</b> {{ portfolio.portfolio_name }}
                  </h5>
                  <h5 class="card-text">
                    <b>Mualiflar:</b> {{ portfolio.portfolio_authors }}
                  </h5>
                  <h5 class="card-text">
                    <b>Nashriyot:</b> {{ portfolio.portfolio_address }}
                  </h5>
                  {% if portfolio.portfolio_description %}
                  <h5 class="card-text text-align-justify">
                    <b>Izoh: </b> {{ portfolio.portfolio_description }}
                  </h5>
                  <h5 class="card-text text-align-justify">
                    <b>Sana: </b> {{ portfolio.portfolio_date }}
                  </h5>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          <!-- left img -->
          <!-- right img -->
          {% else %}
          <div class="card portfolio_card mb-3">
            <div class="row align-items-center g-0">
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title">
                    <b>Kategoriya:</b> {{ portfolio.category }}
                  </h5>
                  <h5 class="card-title">
                    <b>Nomi:</b> {{ portfolio.portfolio_name }}
                  </h5>
                  <h5 class="card-text">
                    <b>Mualiflar:</b> {{ portfolio.portfolio_authors }}
                  </h5>
                  <h5 class="card-text">
                    <b>Nashriyot:</b> {{ portfolio.portfolio_address }}
                  </h5>
                  {% if portfolio.portfolio_description %}
                  <h5 class="card-text text-align-justify">
                    <b>Izoh: </b> {{ portfolio.portfolio_description }}
                  </h5>
                  <h5 class="card-text text-align-justify">
                    <b>Sana: </b> {{ portfolio.portfolio_date }}
                  </h5>
                  {% endif %}
                </div>
              </div>
              <div class="col-md-4">
                <canvas data-pdf="{{ portfolio.portfolio_file.url }}" class="w-100 port_card_img jsImg shadow pdf_render">
                </canvas>
              </div>
            </div>
          </div>
          {% endif %} 
          {% endfor %}
        </div>
      </div>
      <!-- portfolio end -->
    </div>
  </div>
</section>
<!-- portfolio end -->

<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
<script>
  function renderPDFFiles() {
    let canvases = document.querySelectorAll(".pdf_render");
    canvases.forEach((item) => {
      let url = item.getAttribute('data-pdf');
      // console.log(item.getAttribute('data-pdf'));
      let pdfDoc = null,
        pageNum = 1,
        pageIsRendering = false,
        pageNumIsPending = null;
      const scale = 8,
        canvas = item,
        ctx = canvas.getContext("2d");

      const renderPage = (num) => {
        pageIsRendering = true;
        pdfDoc.getPage(num).then((page) => {
          const viewport = page.getViewport({ scale });
          canvas.height = viewport.height;
          canvas.width = viewport.width;

          const renderCtx = {
            canvasContext: ctx,
            viewport,
          };
          page.render(renderCtx).promise.then(() => {
            pageIsRendering = false;
            if (pageNumIsPending !== null) {
              renderPage(pageNumIsPending);
              pageNumIsPending = null;
            }
          });
          document.querySelector(".page_num").textContent = num;
        });
      };

      const queueRenderPage = (num) => {
        if (pageIsRendering) {
          pageNumIsPending = num;
        } else {
          renderPage(num);
        }
      };

      const showPrevPage = () => {
        if (pageNum <= 1) {
          return;
        }
        pageNum--;
        queueRenderPage(pageNum);
      };
      const showNextPage = () => {
        if (pageNum >= pdfDoc.numPages) {
          return;
        }
        pageNum++;
        queueRenderPage(pageNum);
      };

      pdfjsLib.getDocument(url).promise.then((pdfDoc_) => {
        pdfDoc = pdfDoc_;
        document.querySelector(".page_count").textContent = pdfDoc.numPages;
        renderPage(pageNum);
      });

      document
        .querySelector("#prev-page")
        .addEventListener("click", showPrevPage);
      document
        .querySelector("#next-page")
        .addEventListener("click", showNextPage);
    });
  }
  renderPDFFiles();
</script>

{% endblock %}